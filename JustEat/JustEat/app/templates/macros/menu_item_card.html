{% macro render_menu_item_for_user(item, slug, qty_in_cart, is_active=True, popular=False, is_favorited=False) %}
<div
    class="card border-0 z-0 rounded-0 border-bottom p-1 p-md-3 max-w-md w-100 mb-2 {{ 'bg-color opacity-25' if not (item.is_active and is_active) else ''}} ">
    <div class="row g-0">
        <div class="col-9 col-lg-10 p-1 p-md-3">
            <div class="d-flex justify-content-between align-items-start mb-1">
                <h5 class="fw-semibold mb-0 font-quicksand">{{ item.name|title }}</h5>
                <!-- Favorite Button -->
                {% if current_user and current_user.is_authenticated %}
                <form action="{{ url_for('customer.toggle_menu_item_favorite', menu_item_id=item.id) }}" method="POST" class="ms-2">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button type="submit" class="btn btn-sm p-1 border-0 bg-transparent">
                        <i class="bi bi-heart{{ '-fill text-danger' if is_favorited else ' text-muted' }}" style="font-size: 1.1rem;"></i>
                    </button>
                </form>
                {% endif %}
            </div>
            <div>
                {% from "macros/svg_icons.html" import render_icon %}
                {{ render_icon(item.is_non_veg) }}
                {% if item.is_special %}
                <div class="badge px-1 text-bg-info text-xs">
                    <i class="bi bi-stars text-gold"></i>
                    Special
                </div>
                {% endif %}
                {% if popular %}
                <div class="badge px-1 text-bg-warning text-xs">
                    <i class="bi bi-fire"></i>
                    Mostly Ordered
                </div>
                {% endif %}
            </div>
            <p class="card-text text-xs text-muted mb-2">
                <span class="text-nowrap">
                    <i class="bi bi-cup-hot"></i>
                    {{ item.cuisine.name }}
                </span>
                &middot;
                <span class="text-nowrap">
                    <i class="bi bi-tag"></i>
                    {{ item.category.name }}
                </span>
            </p>
            <div class="d-flex justify-content-between align-items-center">
                <p class="fw-semibold fs-5 mb-1 text-muted">₹ {{ '%.2f' | format(item.price) }}</p>
                {% if item.rating_count %}
                <div class="d-flex gap-2">
                    {% from "macros/rating.html" import render_rating_stars %}
                    <div>{{ render_rating_stars(item.avg_rating) }}</div>

                    <h5 class="fw-bold mb-2">
                        {{ item.avg_rating|round(1) }}
                    </h5>
                    <span class="text-sm align-self-center text-muted">({{ item.rating_count }})</span>
                </div>
                {% endif %}
            </div>
            <p class="small text-body-secondary mb-0 overflow-hidden text-nowrap text-truncate">{{ item.description }}
            </p>
        </div>

        <div class="position-relative col-3 col-lg-2">
            <div class="ratio ratio-1x1">
                <img src="{{ item.image }}" class="w-100 h-100 rounded-3 object-fit-cover" alt="{{ item.name }}">
            </div>
            {% if is_active and item.is_active %}
            <div class="position-absolute start-0 end-0 bottom-0 mb-2 d-flex">
                {% if not qty_in_cart %}
                <form action="{{ url_for('customer.add_to_cart', slug=slug, item_id=item.id) }}" method="post"
                    class="w-75 mx-auto">
                    <input type="hidden" name="csrf_token" id="csrf_token" value="{{ csrf_token() }}">
                    <button class="btn btn-success rounded-3 btn-sm text-sm w-100">
                        <i class="bi bi-plus-lg"></i>
                        Add
                    </button>
                </form>
                {% else %}
                <div class="w-75 d-flex bg-body-secondary rounded-3 mx-auto align-items-center">
                    <form class="w-50" action="{{ url_for('customer.remove_from_cart', slug=slug, item_id=item.id) }}"
                        method="post">
                        <input type="hidden" name="csrf_token" id="csrf_token" value="{{ csrf_token() }}">
                        <button class="rounded-0 rounded-start-3 btn btn-icon btn-sm btn-success">
                            <i class="bi bi-dash-lg"></i>
                        </button>
                    </form>
                    <span class="w-100 fw-bold text-center">{{ qty_in_cart }}</span>
                    <form class="w-50" action="{{ url_for('customer.add_to_cart', slug=slug, item_id=item.id) }}"
                        method="post">
                        <input type="hidden" name="csrf_token" id="csrf_token" value="{{ csrf_token() }}">
                        <button class="rounded-0 rounded-end-3 btn btn-icon btn-sm btn-success">
                            <i class="bi bi-plus-lg"></i>
                        </button>
                    </form>
                </div>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endmacro %}

{% macro render_menu_item_for_owner(item, slug, popular=True) %}
<!-- Menu Item Card -->
<div class="col card mb-1 p-0 ">
    <div class="img-container w-100">
        <img src="{{ item.image }}" class="card-img-top h-100 w-100 object-fit-cover" alt="{{ item.name }}">
    </div>
    <div class="card-body d-flex flex-column pb-0">
        <h6 class="card-title fw-semibold font-quicksand mb-0">
            {{ item.name|title }}
        </h6>
        {% if item.rating_count %}
        <div class="d-flex gap-2">
            {% from "macros/rating.html" import render_rating_stars %}
            <div>{{ render_rating_stars(item.avg_rating) }}</div>

            <h5 class="fw-bold mb-2">
                {{ item.avg_rating|round(1) }}
            </h5>
            <span class="text-sm align-self-center text-muted">({{ item.rating_count }})</span>
        </div>
        {% endif %}
        <div class="d-flex gap-1 align-items-center my-1">
            {% from "macros/svg_icons.html" import render_icon %}
            {{ render_icon(item.is_non_veg) }}
            {% if item.is_special %}
            <div class="badge px-1 text-bg-info text-xs">
                <i class="bi bi-stars text-gold"></i>
                Special
            </div>
            {% endif %}
            {% if popular %}
            <div class="badge px-1 text-bg-warning text-xs">
                <i class="bi bi-fire"></i>
                Mostly Ordered
            </div>
            {% endif %}
        </div>

        <p class="card-text text-xs text-muted mb-2">
            <span class="text-nowrap">
                <i class="bi bi-cup-hot"></i>
                {{ item.cuisine.name }}
            </span>
            &middot;
            <span class="text-nowrap">
                <i class="bi bi-tag"></i>
                {{ item.category.name }}
            </span>
        </p>
        <p class="card-text text-muted text-sm lh-sm mb-3 line-clamp-2">{{ item.description }}</p>
        <h6 class="text-warning fw-bold mb-3 mt-auto">₹ {{ '{:.2f}'.format(item.price) }}</h6>
    </div>
    <div class="card-footer d-flex gap-2">
        {% if slug %}
        <a href="{{ url_for('restaurant.edit_menu_item', slug=slug, item_id=item.id) }}"
            class="btn btn-sm btn-outline-primary">
            <i class="bi bi-pencil"></i>
            Edit
        </a>
        <form method="POST" action="{{ url_for('restaurant.delete_menu_item', slug=slug, item_id=item.id) }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="btn btn-sm btn-outline-danger"
                onclick="return confirm('Are you sure you want to delete this item?')">
                <i class="bi bi-trash"></i>
                Delete
            </button>
        </form>
        <div class="dropdown">
            <button class="btn btn-outline-secondary btn-sm" type="button" data-bs-toggle="dropdown"
                aria-expanded="false">
                <i class="bi bi-three-dots-vertical"></i>
            </button>
            <ul class="dropdown-menu shadow-sm">
                <form
                    action="{{ url_for('restaurant.update_special_status', slug=slug, item_id=item.id, special=(not item.is_special)) }}"
                    method="post" class="dropdown-item">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button class="btn btn-link btn-sm text-decoration-none text-body">
                        {{'Unmark' if item.is_special else 'Mark'}} Special
                    </button>
                </form>
                <form action="{{ url_for('restaurant.update_active_status', slug=slug, item_id=item.id, active=(not item.is_active)) }}" method="post" class="dropdown-item">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <button class="btn btn-link btn-sm text-decoration-none text-body">
                        Mark {{'unavailable' if item.is_active else 'available'}}
                    </button>
                </form>
            </ul>
        </div>
        {% endif %}
    </div>
</div>
{% endmacro %}

{% macro render_mini_menu_item_card(item, popular=False) %}
<div class="card h-100">
    <img src="{{ item.image }}" alt="{{ item.name }}" class="h-100 w-100 object-fit-cover card-img-top img-fluid">
    <div class="card-body">

        <h6 class="card-title fw-semibold mb-0">{{ item.name }}</h6>

        <div class="card-text text-nowrap  overflow-hidden">
            <p class="mb-1 text-muted text-sm text-truncate">
                <span>
                    <i class="bi bi-buildings"></i>
                    {{ item.restaurant.name }}
                </span>
                &middot;
                <span>
                    <i class="bi bi-geo-alt"></i>
                    {{ item.restaurant.location }}
                </span>
            </p>
        </div>

        <div>
            {% from "macros/svg_icons.html" import render_icon %}
            {{ render_icon(item.is_non_veg) }}
            {% if item.is_special %}
            <div class="badge px-1 text-bg-info text-xs">
                <i class="bi bi-stars text-gold"></i>
                Special
            </div>
            {% endif %}
            {% if popular %}
            <div class="badge px-1 text-bg-warning text-xs">
                <i class="bi bi-fire"></i>
                Mostly Ordered
            </div>
            {% endif %}
        </div>

        <p class="card-text text-xs text-muted mb-2">
            <span class="text-nowrap">
                <i class="bi bi-cup-hot"></i>
                {{ item.cuisine.name }}
            </span>
            &middot;
            <span class="text-nowrap">
                <i class="bi bi-tag"></i>
                {{ item.category.name }}
            </span>
        </p>

        <div class="d-flex justify-content-between">
            <h6 class="text-warning fw-bold mb-0 mt-auto">₹ {{ '{:.2f}'.format(item.price) }}</h6>
            <a href="{{ url_for('customer.restaurant_info', slug=item.restaurant.slug) }}" class="link-secondary">
                Visit
                <i class="bi bi-arrow-right"></i>
            </a>
        </div>

    </div>
</div>
{% endmacro %}