{% extends "base.html" %} {% block content %}

<!-- Custom Confirmation Modal -->
<div id="confirmModal" class="modal-overlay" style="display: none">
  <div class="modal-container">
    <div class="modal-header">
      <svg class="modal-icon" viewBox="0 0 24 24" width="24" height="24">
        <circle
          cx="12"
          cy="12"
          r="10"
          stroke="#d13438"
          stroke-width="2"
          fill="none"
        />
        <line x1="15" y1="9" x2="9" y2="15" stroke="#d13438" stroke-width="2" />
        <line x1="9" y1="9" x2="15" y2="15" stroke="#d13438" stroke-width="2" />
      </svg>
      <h3 class="modal-title">Delete Task</h3>
    </div>
    <div class="modal-body">
      <p class="modal-message">Are you sure you want to delete this task?</p>
      <p class="modal-submessage">This action cannot be undone.</p>
    </div>
    <div class="modal-actions">
      <button type="button" class="modal-btn modal-btn-cancel" id="modalCancel">
        Cancel
      </button>
      <button
        type="button"
        class="modal-btn modal-btn-delete"
        id="modalConfirm"
      >
        Delete
      </button>
    </div>
  </div>
</div>

<!-- Clear All Confirmation Modal -->
<div id="clearAllModal" class="modal-overlay" style="display: none">
  <div class="modal-container">
    <div class="modal-header">
      <svg class="modal-icon" viewBox="0 0 24 24" width="24" height="24">
        <path
          d="M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M10 11v6M14 11v6"
          stroke="#d13438"
          stroke-width="2"
          fill="none"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
        <path
          d="M5 6l1 14a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2l1-14"
          stroke="#d13438"
          stroke-width="2"
          fill="none"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
      <h3 class="modal-title">Clear All Completed</h3>
    </div>
    <div class="modal-body">
      <p class="modal-message">
        Are you sure you want to delete all completed tasks?
      </p>
      <p class="modal-submessage">
        This will permanently remove all completed items and cannot be undone.
      </p>
    </div>
    <div class="modal-actions">
      <button
        type="button"
        class="modal-btn modal-btn-cancel"
        id="clearAllCancel"
      >
        Cancel
      </button>
      <button
        type="button"
        class="modal-btn modal-btn-delete"
        id="clearAllConfirm"
      >
        Clear All
      </button>
    </div>
  </div>
</div>

<div class="todo-container">
  <h1>
    <svg
      class="todo-heading-icon"
      width="32"
      height="32"
      viewBox="0 0 24 24"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      />
      <polyline
        points="14,2 14,8 20,8"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      />
      <line
        x1="9"
        y1="13"
        x2="15"
        y2="13"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
      />
      <line
        x1="9"
        y1="17"
        x2="15"
        y2="17"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
      />
    </svg>
    Todo List
  </h1>
  <form
    method="post"
    action="{{ url_for('add_todo') }}"
    id="todo-form"
    class="todo-form"
  >
    <input
      type="text"
      name="task"
      placeholder="Add new todo item"
      required
      id="task-input"
      class="todo-input"
    />
    <button type="submit" class="btn">Add</button>
  </form>
  <div class="todo-sections">
    <div class="todo-section">
      <h2>Incomplete Items</h2>
      <ul id="incomplete-list" class="todo-list">
        {% set incomplete_todos = todos|selectattr('completed', 'equalto',
        false)|list %} {% for todo in incomplete_todos %}
        <li data-id="{{ todo.id }}" class="todo-item">
          <div class="todo-content">
            <form
              method="post"
              action="{{ url_for('edit_todo', todo_id=todo.id) }}"
              class="edit-form"
            >
              <input
                type="text"
                name="task"
                value="{{ todo.task }}"
                required
                class="edit-input"
              />
              <div class="edit-buttons">
                <button type="submit" class="btn small-btn">Update</button>
                <button
                  class="btn small-btn complete-btn"
                  data-id="{{ todo.id }}"
                >
                  Complete
                </button>
                <button
                  class="btn small-btn delete-btn"
                  data-id="{{ todo.id }}"
                >
                  Delete
                </button>
              </div>
            </form>
          </div>
        </li>
        {% endfor %} {% if incomplete_todos|length == 0 %}
        <li class="todo-item">No incomplete items</li>
        {% endif %}
      </ul>
    </div>
    <div class="todo-section">
      <h2>Completed Items</h2>
      <ul id="completed-list" class="todo-list">
        {% set completed_todos = todos|selectattr('completed', 'equalto',
        true)|list %} {% set incomplete_todos = todos|selectattr('completed',
        'equalto', false)|list %} {% for todo in completed_todos %}
        <li data-id="{{ todo.id }}" class="todo-item completed">
          <div class="todo-content">
            <s>{{ todo.task }}</s>
          </div>
          <div class="todo-actions">
            <button class="btn small-btn undo-btn" data-id="{{ todo.id }}">
              Undo
            </button>
          </div>
          <div class="completed-watermark">
            <svg
              class="completed-icon"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
            >
              <circle
                cx="12"
                cy="12"
                r="11"
                fill="#ffffff"
                stroke="#28a745"
                stroke-width="2"
              />
              <circle cx="12" cy="12" r="9" fill="#28a745" />
              <path
                d="M8 12l3 3 5-6"
                stroke="#ffffff"
                stroke-width="2.5"
                stroke-linecap="round"
                stroke-linejoin="round"
                fill="none"
              />
            </svg>
            <span class="completed-text">Completed</span>
          </div>
        </li>
        {% endfor %} {% if completed_todos|length == 0 %}
        <li class="todo-item">No completed items</li>
        {% endif %}
      </ul>

      <!-- Show Clear All button when all tasks are completed and there are completed tasks -->
      {% if completed_todos|length > 0 and incomplete_todos|length == 0 %}
      <div style="text-align: center; margin-top: 1rem">
        <button
          class="btn clear-all-btn"
          onclick="showClearAllModal()"
          style="background: #dc3545; font-size: 0.9rem; padding: 0.5rem 1.5rem"
        >
          Clear All
        </button>
      </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
